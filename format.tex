\usepackage{xcolor}
\usepackage{framed}
\usepackage{datetime}
\usepackage[T1]{fontenc}
\usepackage{fourier}
\usepackage{marginnote}
%\usepackage[utf8]{inputenc}
%\usepackage{tikz}
% page layout
\usepackage[top=2cm, bottom=2cm, outer=4cm, inner=2cm, heightrounded, marginparwidth=2cm, marginparsep=0.75cm]{geometry}

% show keywors on the margin
\newcommand{\mykey}[1]{%
  %\marginnote{{\color{red}CAUTION!}\\{#1}}
  \marginnote{{\color{red}#1}}
}

\newlength\sidebar
\newlength\envrule
\newlength\envborder
\setlength\sidebar{1.5mm}
\setlength\envrule{0.4pt}
\setlength\envborder{2mm}

\makeatletter
  \long\def\fboxs#1{%
    \leavevmode
    \setbox\@tempboxa\hbox{%
      \color@begingroup
      \kern\fboxsep{#1}\kern\fboxsep
      \color@endgroup
    }%
    \@frames@x\relax
  }

\def\frameboxs{%
  \@ifnextchar(%)
  \@framepicbox{\@ifnextchar[\@frameboxs\fboxs}
}

\def\@frameboxs[#1]{%
  \@ifnextchar[%]
     {\@iframeboxs[#1]}%
     {\@iframeboxs[#1][c]}
}

\long\def\@iframeboxs[#1][#2]#3{%
  \leavevmode
  \@begin@tempboxa\hbox{#3}%
    \setlength\@tempdima{#1}%
    \setbox\@tempboxa\hb@xt@\@tempdima
      {\kern\fboxsep\csname bm@#2\endcsname\kern\fboxsep}%
    \@frames@x{\kern-\fboxrule}%
  \@end@tempboxa
}

\def\@frames@x#1{%
  \@tempdima\fboxrule
  \advance\@tempdima\fboxsep
  \advance\@tempdima\dp\@tempboxa
  \hbox{%
    \lower\@tempdima\hbox{%
      \vbox{%
        %\hrule\@height\fboxrule
        \hbox{%
         \vrule\@width\fboxrule
          #1%
          \vbox{%
            \vskip\fboxsep
            \box\@tempboxa
            \vskip\fboxsep
          }%
          #1%
        }%
      }% 
    }%
  }%
}

\def\esefcolorbox#1#{
  \esecolor@fbox{#1}
}
\def\esecolor@fbox#1#2#3{%
  \color@b@x{\fboxsep\z@\color#1{#2}\fboxs}{\color#1{#3}}
}
\makeatother

% define colors
\definecolor{myborder}{HTML}{FE642E}
\definecolor{mybg}{HTML}{CEF6EC}
%\definecolor{myborder}{rgb}{.9,0,0}
%\definecolor{mybg}{rgb}{1,1,1}

\newenvironment{eseframed}{%
  \def\FrameCommand{\fboxrule=\the\sidebar  \fboxsep=\the\envborder%
  %\esefcolorbox{myborder}{mybg}}%
  \esefcolorbox{myborder}{mybg}}%
  \MakeFramed{\FrameRestore}
}%
{
  \endMakeFramed
}

\newcounter{diary}
\renewcommand{\thediary}{\arabic{diary}}

%%% CODE ENVIRONMENT. PUT TEXT INTO COLORED FRAME %%%
\newenvironment{diary}[2] {
  \par\medskip\refstepcounter{diary}%
  \hbox{%
    \fboxsep=\the\sidebar\hspace{-\envborder}\hspace{-.5\sidebar}%
    \colorbox{myborder}{%
      \hspace{\envborder}\footnotesize\sffamily\bfseries%
      \textcolor{white}{{#1}\ {#2}\enspace\hspace{\envborder}}
    }
  }
  \nointerlineskip\vspace{-\topsep}%
  \begin{eseframed}\noindent\ignorespaces%
}{
  \end{eseframed}\vspace{-\baselineskip}\medskip
}
